<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Windmill Health Monitor</title>

  <!-- CSS + Fonts -->
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600&display=swap" rel="stylesheet" />

  <!-- Libraries -->
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>

  <link rel="icon" type="image/svg+xml" href="a-logo.svg" />
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>

<body>

  <!-- ğŸ” LOGIN SCREEN -->
  <div id="login-page" class="login-screen">
    <img src="static/adani-renewables.png" alt="Adani Renewables" class="login-logo" />
    <div class="login-left">
      <div class="login-modal">
        <h2>LOGIN</h2>
        <p>Windmill Health Monitoring System</p>
        <input type="text" id="login-username" placeholder="Username" />
        <input type="password" id="login-password" placeholder="Password" />
        <button id="login-btn">Login</button>
        <button class="request-access-btn" onclick="requestAccess()">
          ğŸ“© Request Access
        </button>
      </div>
    </div>
    <div class="login-right">
      <div class="image-columns">
        <div class="column scroll-down">
          <img src="static/snapshot1.jpeg" class="snapshot" />
          <img src="static/snapshot2.jpeg" class="snapshot" />
          <img src="static/snapshot3.jpeg" class="snapshot" />
          <img src="static/snapshot4.jpeg" class="snapshot" />
          <img src="static/snapshot5.jpeg" class="snapshot" />
          <img src="static/snapshot6.jpeg" class="snapshot" />
          <img src="static/snapshot1.jpeg" class="snapshot" />
          <img src="static/snapshot2.jpeg" class="snapshot" />
          <img src="static/snapshot3.jpeg" class="snapshot" />
          <img src="static/snapshot1.jpeg" class="snapshot" />
          <img src="static/snapshot2.jpeg" class="snapshot" />
          <img src="static/snapshot3.jpeg" class="snapshot" />
          <img src="static/snapshot4.jpeg" class="snapshot" />
          <img src="static/snapshot5.jpeg" class="snapshot" />
          <img src="static/snapshot6.jpeg" class="snapshot" />
          <img src="static/snapshot1.jpeg" class="snapshot" />
          <img src="static/snapshot2.jpeg" class="snapshot" />
          <img src="static/snapshot3.jpeg" class="snapshot" />
          <img src="static/snapshot1.jpeg" class="snapshot" />
          <img src="static/snapshot2.jpeg" class="snapshot" />
          <img src="static/snapshot3.jpeg" class="snapshot" />
          <img src="static/snapshot4.jpeg" class="snapshot" />
          <img src="static/snapshot5.jpeg" class="snapshot" />
          <img src="static/snapshot6.jpeg" class="snapshot" />
          <img src="static/snapshot1.jpeg" class="snapshot" />
          <img src="static/snapshot2.jpeg" class="snapshot" />
          <img src="static/snapshot3.jpeg" class="snapshot" />
          <img src="static/snapshot1.jpeg" class="snapshot" />
          <img src="static/snapshot2.jpeg" class="snapshot" />
          <img src="static/snapshot3.jpeg" class="snapshot" />
          <img src="static/snapshot4.jpeg" class="snapshot" />
          <img src="static/snapshot5.jpeg" class="snapshot" />
          <img src="static/snapshot6.jpeg" class="snapshot" />
          <img src="static/snapshot1.jpeg" class="snapshot" />
          <img src="static/snapshot2.jpeg" class="snapshot" />
          <img src="static/snapshot3.jpeg" class="snapshot" />
        </div>
        <div class="column scroll-up">
          <img src="static/snapshot4.jpeg" class="snapshot" />
          <img src="static/snapshot5.jpeg" class="snapshot" />
          <img src="static/snapshot6.jpeg" class="snapshot" />
          <img src="static/snapshot1.jpeg" class="snapshot" />
          <img src="static/snapshot2.jpeg" class="snapshot" />
          <img src="static/snapshot3.jpeg" class="snapshot" />
          <img src="static/snapshot4.jpeg" class="snapshot" />
          <img src="static/snapshot5.jpeg" class="snapshot" />
          <img src="static/snapshot6.jpeg" class="snapshot" />
          <img src="static/snapshot4.jpeg" class="snapshot" />
          <img src="static/snapshot5.jpeg" class="snapshot" />
          <img src="static/snapshot6.jpeg" class="snapshot" />
          <img src="static/snapshot1.jpeg" class="snapshot" />
          <img src="static/snapshot2.jpeg" class="snapshot" />
          <img src="static/snapshot3.jpeg" class="snapshot" />
          <img src="static/snapshot4.jpeg" class="snapshot" />
          <img src="static/snapshot5.jpeg" class="snapshot" />
          <img src="static/snapshot6.jpeg" class="snapshot" />
          <img src="static/snapshot4.jpeg" class="snapshot" />
          <img src="static/snapshot5.jpeg" class="snapshot" />
          <img src="static/snapshot6.jpeg" class="snapshot" />
          <img src="static/snapshot1.jpeg" class="snapshot" />
          <img src="static/snapshot2.jpeg" class="snapshot" />
          <img src="static/snapshot3.jpeg" class="snapshot" />
          <img src="static/snapshot4.jpeg" class="snapshot" />
          <img src="static/snapshot5.jpeg" class="snapshot" />
          <img src="static/snapshot6.jpeg" class="snapshot" />
          <img src="static/snapshot4.jpeg" class="snapshot" />
          <img src="static/snapshot5.jpeg" class="snapshot" />
          <img src="static/snapshot6.jpeg" class="snapshot" />
          <img src="static/snapshot1.jpeg" class="snapshot" />
          <img src="static/snapshot2.jpeg" class="snapshot" />
          <img src="static/snapshot3.jpeg" class="snapshot" />
          <img src="static/snapshot4.jpeg" class="snapshot" />
          <img src="static/snapshot5.jpeg" class="snapshot" />
          <img src="static/snapshot6.jpeg" class="snapshot" />
        </div>
      </div>
    </div>
    <div class="login-footer-label">
      Â© Energy Network Operations Center
    </div>
  </div>

  <!-- Loader -->
  <div id="loader">
    <h1 class="typewriter" id="loader-text"></h1>
  </div>

  <!-- Menu Page -->
  <div id="main-menu" style="display: none; flex-direction: column; position: relative; overflow: hidden;">
    <!-- ğŸ” Background Windmill Video -->
    <div class="menu-bg-video">
      <video autoplay muted loop playsinline>
        <source src="{{ url_for('static', filename='windmill.mp4') }}" type="video/mp4" />
      </video>
      <div class="video-overlay"></div>
    </div>
    <div class="menu-header">
      <img src="{{ url_for('static', filename='adani_renewables.png') }}" class="adani-logo" />
    </div>
    <div class="menu-options">
      <div class="menu-item"><span>âš¡ Generator</span></div>
      <div class="menu-item" onclick="launchGearbox()"><span>âš™ï¸ Gearbox</span></div>
    </div>
  </div>

  <!-- Main App Content -->
  <div id="main-content" style="display: none;">
    <header class="custom-header">
      <img src="{{ url_for('static', filename='adani_renewables.png') }}" alt="Logo" class="header-logo" />
      <h1 class="gradient-title">Windmill Health Monitor</h1>
      <div style="min-width: 60px; display: flex; justify-content: flex-end;">
        <label class="switch">
          <input type="checkbox" id="theme-toggle" />
          <span class="slider round"></span>
        </label>
      </div>
    </header>

    <!-- ğŸ”” Asset ID Error Box -->
    <div id="asset-alert" style="display:none; color:red; font-weight:bold; text-align:center; margin: 15px auto;">
    </div>

    <!-- Upload Section -->
    <section class="upload-container" onclick="document.getElementById('excelFile').click()" style="margin-top: 120px;">
      <div class="upload-left">
        <h2 class="upload-placeholder gradient-placeholder">ğŸ“ Browse files from your device....</h2>
        <img src="https://cdn-icons-png.flaticon.com/512/732/732220.png" class="excel-icon" alt="Excel Icon" />
      </div>
      <div class="upload-right">
        <span class="upload-label">â¬†ï¸ Upload</span>
      </div>
      <input type="file" id="excelFile" accept=".xlsx, .xls" />
    </section>

    <!-- File Preview -->
    <div id="preview-container" style="display: none;">
      <h3>ğŸ‘€ Preview of Uploaded File</h3>
      <div id="excel-preview"></div>
    </div>

    <!-- Excel Parsing Loader -->
    <div id="excel-loader" class="excel-loader hidden">
      <span class="loader-text">Parsing Excel and preparing preview</span>
      <div class="dot-container">
        <span class="dot wave1"></span>
        <span class="dot wave2"></span>
        <span class="dot wave3"></span>
        <span class="dot wave4"></span>
      </div>
    </div>

    <!-- Predict & Dashboard Buttons -->
    <div style="text-align: center; margin-top: 20px;">
      <button onclick="predictWithModel()" class="predict-btn">ğŸ¤– Predict with Trained Model</button>
      <button onclick="uploadAndGoToDashboard()" class="predict-btn" style="margin-left: 10px;">
        ğŸ¦… Bird's Eye View
      </button>
    </div>

    <!-- Step Progress UI -->
    <div class="step-progress-wrapper" id="step-progress" style="display: none;">
      <div class="step-circle active">1</div>
      <div class="step-line" id="step-line-1"></div>
      <div class="step-circle" id="step-two">2</div>
      <div class="step-line" id="step-line-2"></div>
      <div class="step-circle" id="step-three">3</div>
    </div>

    <!-- Result Container -->
    <div id="model-result-container" style="display: none; margin-top: 30px;">
      <!-- Success Message -->
      <div class="model-success-box">
        âœ… Timestamp column removed. 5 target columns separated. 145 features extracted for testing the model.
      </div>

      <div class="section-wrapper">
        <!-- Metrics -->
        <div id="target-metrics-container" style="display: none;">
          <h3>ğŸ¯ Target-wise Model Performance</h3>
          <div class="target-metrics-grid" id="target-metrics-grid"></div>
        </div>

        <!-- Filters -->
        <div id="prediction-filters" style="display: none; margin: 20px 0;">
          <label><strong>ğŸ¯ Filter by Target Column(s):</strong></label>
          <div id="target-checkboxes" class="checkbox-group"></div>

          <label style="margin-top: 10px;"><strong>ğŸ”¢ Number of Entries to Display:</strong></label>
          <input type="range" id="entry-slider" min="1" max="100" value="20"
            oninput="document.getElementById('entry-count').textContent = this.value">
          <span id="entry-count">20</span>

          <select id="entry-dropdown" style="margin-top: 10px;">
            <option value="10">First 10</option>
            <option value="20">First 20</option>
            <option value="50">First 50</option>
            <option value="all">Show All</option>
          </select>
        </div>

        <!-- Table Header + Download Button -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 30px;">
          <h3>ğŸ“Š Prediction Results</h3>
          <button id="download-report-btn" class="btn btn-download">ğŸ“¥ Download Report</button>
        </div>

        <!-- Table -->
        <div id="model-deviation-table" style="margin-top: 10px; overflow-x: auto;"></div>

        <!-- Step 3 Trigger -->
        <div style="text-align: center; margin-top: 30px;">
          <button onclick="goToStep3()" class="step-btn">ğŸ“ˆ Generate Chart & Alerts</button>
        </div>

        <!-- Step 3 Chart & Alerts -->
        <div id="chart-section-wrapper"
          style="display: none; margin-top: 40px; width: 100%; padding: 20px; box-sizing: border-box;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <h3>ğŸ“‰ Prediction Chart & Alerts</h3>
            <button onclick="downloadAlerts()" class="download-btn" id="download-alerts-btn">
              â¬‡ï¸ Download Alerts Report
            </button>
          </div>

          <div class="chart-controls">
            <label><strong>ğŸ¯ Select Target:</strong></label>
            <select id="chart-target-dropdown"></select>

            <!-- Chart Toggles -->
            <div id="chart-toggles" style="margin-top: 15px;">
              <label><input type="checkbox" class="chart-toggle" value="actual" checked> Actual</label>
              <label><input type="checkbox" class="chart-toggle" value="predicted" checked> Predicted</label>
              <label><input type="checkbox" class="chart-toggle" value="upper" checked> Upper Bound</label>
              <label><input type="checkbox" class="chart-toggle" value="lower" checked> Lower Bound</label>
            </div>

            <label style="margin-left: 20px;"><strong>ğŸ”¢ Entries:</strong></label>
            <select id="chart-entry-dropdown">
              <option value="144">1 Day</option>
              <option value="288">2 Day</option>
              <option value="1008">Week</option>
              <option value="all">Show All</option>
            </select>
          </div>

          <!-- ğŸ“… Date Filter -->
          <div id="date-filter" style="display: none; margin: 20px 0; gap: 10px; align-items: center; flex-wrap: wrap;">
            <label>ğŸ“… From: <input type="date" id="start-date" /></label>
            <label>To: <input type="date" id="end-date" /></label>
            <button id="apply-btn">Apply</button>
            <button id="reset-btn">Reset</button>
          </div>

          <!-- ğŸ“ˆ Plotly Chart Container -->
          <div style="position: relative; width: 100%; min-height: 550px;">
            <div id="step3Chart" style="width: 100%; height: 500px;"></div>
          </div>

          <!-- âš ï¸ Alerts List -->
          <div id="alert-box-wrapper" style="width: 100%; padding: 20px; box-sizing: border-box;">
            <div id="alert-box"></div>
          </div>

          <!-- Fixed Button Placement (outside scroll area) -->
          <div id="alert-button-container" style="text-align: center; margin-top: 20px;"></div>
        </div>
      </div>
    </div>

    <!-- Error -->
    <div id="model-error" style="display: none; color: red; font-weight: bold; margin-top: 20px;"></div>
  </div>


  <!-- User Guide Button & Panel -->
  <div class="user-guide-container" id="user-guide-container">
    <button id="user-guide-toggle">
      <span class="guide-icon">ğŸ’¡</span>
      <span class="guide-text">User Guide</span>
      <span id="guide-arrow" class="guide-arrow">â¤</span>
    </button>

    <div id="user-guide-panel">
      <h3>ğŸ“˜ How to Use</h3>
      <ul>
        <li>ğŸ“ <strong>Upload Excel</strong> file from your system.</li>
        <li>ğŸ¤– Click on <strong>Predict with Trained Model</strong>.</li>
        <li>ğŸ“Š See metrics, chart and alerts step by step.</li>
        <li>â¬‡ï¸ Download prediction or alert reports as CSV.</li>
        <li>ğŸ¦… Use <strong>Bird's Eye View</strong> for dashboard view.</li>
      </ul>
    </div>
  </div>

  <!-- Script -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>

</html>